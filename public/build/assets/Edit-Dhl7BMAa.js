import{r as d,u as _e,d as fe,j as e,H as be,t as X}from"./app-s6NgXo84.js";import{A as ye,C as Ne,b as F,c as q,d as D}from"./app-layout-MdC0vklR.js";import{B as o,c as Y}from"./app-logo-icon-B0fBNtIv.js";import{I as p}from"./input-DxU08Nhu.js";import{L as r}from"./label-CphVOY8c.js";import{T as R}from"./textarea-CKvZM8xf.js";import{S as m,a as u,b as h,c as x,d as l,C as Ce}from"./select-BjCV3DtF.js";import{c as g,a as v,C as _,b as f}from"./card-DnZVNnqQ.js";import{C as Z}from"./checkbox-D2FCCmvd.js";import{R as we,a as U,I}from"./radio-group-Dh41Ngjt.js";import{b as ee,P as se,f as y,a as te,C as ae}from"./popover-6NmkzRh3.js";import{C as O}from"./camera-C9mTW6RN.js";import{T}from"./trash-2-BeV3y9ve.js";import{C as ie}from"./calendar-BGZXX3w6.js";/* empty css            */import"./index-_mjGiuzX.js";import"./index-COLmkTQT.js";import"./index-Cm2o4msX.js";import"./index-D3q0pOp_.js";import"./check-GKsih9Bs.js";import"./en-US-BDqzE9Ni.js";import"./chevron-left-Ba_dhvvN.js";function Ke({order:a,customers:re,garmentTypes:ne,tailors:le,fabrics:ce,statuses:de,categories:G=[]}){const[N,L]=d.useState([]),[j,oe]=d.useState(a.measurement_id?"existing":"skip"),[A,C]=d.useState(!1),[w,me]=d.useState(a.measurement?.measurements||{}),[V,ue]=d.useState(a.measurement?.measurement_type||""),[S,B]=d.useState(a.design_image||null),[P,E]=d.useState(a.customer_fabric_photo||null),[k,z]=d.useState(a.boutique_fabric_photo||null),$=d.useRef(null),H=d.useRef(null),J=d.useRef(null),{data:t,setData:i,put:he,processing:K,errors:c}=_e({customer_id:a.customer_id.toString(),garment_type_id:a.garment_type_id.toString(),tailor_id:a.tailor_id.toString(),measurement_id:a.measurement_id?.toString()||"",measurement_option:"skip",new_measurement_type:"",new_measurements:{},measurement_notes:"",fabric_id:a.fabric_id?.toString()||"",customer_fabric:a.customer_fabric||!1,boutique_fabric:a.boutique_fabric||!1,customer_fabric_photo:null,boutique_fabric_photo:null,design_image:null,payment_method:"cash",stitching_status_id:a.stitching_status_id.toString(),order_date:a.order_date,delivery_date:a.delivery_date,priority:a.priority,total_amount:a.total_amount.toString(),advance_paid:a.advance_paid?.toString()||"",discount:a.discount.toString(),special_instructions:a.special_instructions||"",notes:a.notes||""});d.useEffect(()=>{a.customer_id&&Q(a.customer_id.toString())},[]);const Q=async s=>{if(s)try{const n=await fe.get(`/api/measurements?customer_id=${s}`);L(n.data)}catch(n){console.error("Failed to fetch measurements:",n)}else L([])},xe=async s=>{i("customer_id",s),Q(s)},je=s=>{oe(s),i("measurement_option",s),C(s==="new")},b=G?.find(s=>s.slug===V),pe=j==="new"&&b,ge=s=>{s.preventDefault();const n={...t,new_measurements:j==="new"?w:{}};he(`/orders/${a.id}`,{data:n,onSuccess:()=>{X.success("Order updated successfully")},onError:()=>{X.error("Failed to update order")}})};return e.jsxs(ye,{children:[e.jsx(be,{title:`Edit Order ${a.order_number}`}),e.jsxs("div",{className:"space-y-6 p-4 max-w-6xl mx-auto",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("h1",{className:"text-3xl font-bold",children:["Edit Order ",a.order_number]})}),e.jsxs("form",{onSubmit:ge,className:"space-y-6",children:[e.jsxs(g,{children:[e.jsx(v,{children:e.jsx(_,{children:"Order Details"})}),e.jsx(f,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(r,{children:"Customer *"}),e.jsxs(m,{value:t.customer_id,onValueChange:xe,children:[e.jsx(u,{children:e.jsx(h,{placeholder:"Select customer"})}),e.jsxs(x,{children:[e.jsx("div",{className:"px-2 pb-2 sticky top-0 bg-popover z-10",children:e.jsx(p,{placeholder:"Search customer...",className:"h-8",onChange:s=>{const n=s.target.value.toLowerCase();document.querySelectorAll("[data-customer-item]").forEach(W=>{const ve=W.textContent?.toLowerCase()||"";W.style.display=ve.includes(n)?"":"none"})},onKeyDown:s=>s.stopPropagation()})}),re.map(s=>e.jsx(l,{value:s.id.toString(),"data-customer-item":!0,children:s.name},s.id))]})]}),c.customer_id&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:c.customer_id})]}),e.jsxs("div",{children:[e.jsx(r,{children:"Garment Type *"}),e.jsxs(m,{value:t.garment_type_id,onValueChange:s=>i("garment_type_id",s),children:[e.jsx(u,{children:e.jsx(h,{placeholder:"Select garment type"})}),e.jsx(x,{children:ne.map(s=>e.jsx(l,{value:s.id.toString(),children:s.name},s.id))})]}),c.garment_type_id&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:c.garment_type_id})]}),e.jsxs("div",{children:[e.jsx(r,{children:"Tailor *"}),e.jsxs(m,{value:t.tailor_id,onValueChange:s=>i("tailor_id",s),children:[e.jsx(u,{children:e.jsx(h,{placeholder:"Select tailor"})}),e.jsx(x,{children:le.map(s=>e.jsx(l,{value:s.id.toString(),children:s.name},s.id))})]}),c.tailor_id&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:c.tailor_id})]}),e.jsxs("div",{children:[e.jsx(r,{children:"Status *"}),e.jsxs(m,{value:t.stitching_status_id,onValueChange:s=>i("stitching_status_id",s),children:[e.jsx(u,{children:e.jsx(h,{})}),e.jsx(x,{children:de.map(s=>e.jsx(l,{value:s.id.toString(),children:s.name},s.id))})]})]})]})})]}),t.customer_id&&e.jsxs(g,{children:[e.jsx(v,{children:e.jsx(_,{children:"Measurements"})}),e.jsxs(f,{className:"space-y-4",children:[e.jsxs(we,{value:j,onValueChange:je,children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(U,{value:"skip",id:"skip"}),e.jsx(r,{htmlFor:"skip",className:"cursor-pointer",children:"Skip measurements"})]}),N.length>0&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(U,{value:"existing",id:"existing"}),e.jsx(r,{htmlFor:"existing",className:"cursor-pointer",children:"Use existing measurement"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(U,{value:"new",id:"new"}),e.jsx(r,{htmlFor:"new",className:"cursor-pointer",children:"Create new measurement"})]})]}),j==="existing"&&N.length>0&&e.jsxs("div",{children:[e.jsx(r,{children:"Select Measurement"}),e.jsxs(m,{value:t.measurement_id,onValueChange:s=>i("measurement_id",s),children:[e.jsx(u,{children:e.jsx(h,{placeholder:"Select measurement"})}),e.jsx(x,{children:N.map(s=>e.jsxs(l,{value:s.id.toString(),children:[s.measurement_type," - ",new Date(s.created_at).toLocaleDateString()]},s.id))})]})]}),j==="new"&&e.jsxs("div",{className:"space-y-4 border-t pt-4",children:[e.jsxs("div",{children:[e.jsx(r,{children:"Measurement Type *"}),e.jsxs(m,{value:V,onValueChange:s=>{ue(s),i("new_measurement_type",s)},children:[e.jsx(u,{children:e.jsx(h,{placeholder:"Select measurement type"})}),e.jsx(x,{children:G?.map(s=>e.jsx(l,{value:s.slug,children:s.name},s.id))||[]})]})]}),b&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(r,{className:"text-base font-semibold",children:[b.name," Measurements"]}),e.jsx(o,{type:"button",variant:"ghost",size:"sm",onClick:()=>C(!A),children:A?e.jsx(Ce,{className:"h-4 w-4"}):e.jsx(Ne,{className:"h-4 w-4"})})]}),pe&&e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4 p-4 rounded-lg border border-muted",children:b?.fields.map(s=>e.jsxs("div",{children:[e.jsxs(r,{htmlFor:s.slug,className:"text-sm",children:[s.name," (",s.unit,")",s.is_required&&e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),e.jsx(p,{id:s.slug,type:"number",step:"0.1",placeholder:"0.0",value:w[s.slug]||"",onChange:n=>{const M={...w,[s.slug]:n.target.value};me(M),i("new_measurements",M)},required:s.is_required})]},s.id))}),e.jsxs("div",{children:[e.jsx(r,{className:"mb-2",children:"Measurement Notes"}),e.jsx(R,{value:t.measurement_notes,onChange:s=>i("measurement_notes",s.target.value),rows:2,placeholder:"Any special notes about measurements..."})]})]})]})]})]}),e.jsxs(g,{children:[e.jsx(v,{children:e.jsx(_,{children:"Fabric & Design"})}),e.jsxs(f,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Z,{id:"customer_fabric",checked:t.customer_fabric,onCheckedChange:s=>i("customer_fabric",s)}),e.jsx("label",{htmlFor:"customer_fabric",className:"text-sm cursor-pointer",children:"Customer provided fabric"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Z,{id:"boutique_fabric",checked:t.boutique_fabric,onCheckedChange:s=>i("boutique_fabric",s)}),e.jsx("label",{htmlFor:"boutique_fabric",className:"text-sm cursor-pointer",children:"Boutique provided fabric"})]})]}),t.boutique_fabric&&e.jsxs("div",{children:[e.jsx(r,{children:"Fabric"}),e.jsxs(m,{value:t.fabric_id,onValueChange:s=>i("fabric_id",s),children:[e.jsx(u,{children:e.jsx(h,{placeholder:"Select fabric"})}),e.jsx(x,{children:ce.map(s=>e.jsxs(l,{value:s.id.toString(),children:[s.name," - $",s.price_per_meter,"/meter"]},s.id))})]})]}),t.boutique_fabric&&e.jsxs("div",{children:[e.jsx(r,{children:"Boutique Fabric Photo"}),e.jsxs("div",{className:"flex items-center gap-4 mt-2",children:[e.jsxs(F,{className:"h-24 w-24 rounded-md",children:[e.jsx(q,{src:k||void 0,alt:"Boutique Fabric",className:"object-cover"}),e.jsx(D,{className:"rounded-md bg-muted",children:e.jsx(I,{className:"h-8 w-8 text-muted-foreground"})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(o,{type:"button",variant:"outline",size:"sm",onClick:()=>J.current?.click(),children:[e.jsx(O,{className:"h-4 w-4 mr-2"}),k?"Change":"Upload"]}),k&&e.jsxs(o,{type:"button",variant:"outline",size:"sm",onClick:()=>{z(null),i("boutique_fabric_photo",null)},children:[e.jsx(T,{className:"h-4 w-4 mr-2"}),"Remove"]})]})]}),e.jsx("input",{ref:J,type:"file",accept:"image/*",onChange:s=>{const n=s.target.files?.[0];n&&(i("boutique_fabric_photo",n),z(URL.createObjectURL(n)))},className:"hidden"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"Upload boutique fabric photo (JPG, PNG or GIF. Max 2MB)"})]}),t.customer_fabric&&e.jsxs("div",{children:[e.jsx(r,{children:"Customer Fabric Photo"}),e.jsxs("div",{className:"flex items-center gap-4 mt-2",children:[e.jsxs(F,{className:"h-24 w-24 rounded-md",children:[e.jsx(q,{src:P||void 0,alt:"Fabric",className:"object-cover"}),e.jsx(D,{className:"rounded-md bg-muted",children:e.jsx(I,{className:"h-8 w-8 text-muted-foreground"})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(o,{type:"button",variant:"outline",size:"sm",onClick:()=>H.current?.click(),children:[e.jsx(O,{className:"h-4 w-4 mr-2"}),P?"Change":"Upload"]}),P&&e.jsxs(o,{type:"button",variant:"outline",size:"sm",onClick:()=>{E(null),i("customer_fabric_photo",null)},children:[e.jsx(T,{className:"h-4 w-4 mr-2"}),"Remove"]})]})]}),e.jsx("input",{ref:H,type:"file",accept:"image/*",onChange:s=>{const n=s.target.files?.[0];n&&(i("customer_fabric_photo",n),E(URL.createObjectURL(n)))},className:"hidden"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"Upload customer fabric photo (JPG, PNG or GIF. Max 2MB)"})]}),e.jsxs("div",{children:[e.jsx(r,{children:"Design Image"}),e.jsxs("div",{className:"flex items-center gap-4 mt-2",children:[e.jsxs(F,{className:"h-24 w-24 rounded-md",children:[e.jsx(q,{src:S||void 0,alt:"Design",className:"object-cover"}),e.jsx(D,{className:"rounded-md bg-muted",children:e.jsx(I,{className:"h-8 w-8 text-muted-foreground"})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(o,{type:"button",variant:"outline",size:"sm",onClick:()=>$.current?.click(),children:[e.jsx(O,{className:"h-4 w-4 mr-2"}),S?"Change":"Upload"]}),S&&e.jsxs(o,{type:"button",variant:"outline",size:"sm",onClick:()=>{B(null),i("design_image",null)},children:[e.jsx(T,{className:"h-4 w-4 mr-2"}),"Remove"]})]})]}),e.jsx("input",{ref:$,type:"file",accept:"image/*",onChange:s=>{const n=s.target.files?.[0];n&&(i("design_image",n),B(URL.createObjectURL(n)))},className:"hidden"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"Upload design reference image (JPG, PNG or GIF. Max 2MB)"})]})]})]}),e.jsxs(g,{children:[e.jsx(v,{children:e.jsx(_,{children:"Pricing & Payment"})}),e.jsxs(f,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx(r,{children:"Total Amount *"}),e.jsx(p,{type:"number",step:"0.01",value:t.total_amount,onChange:s=>i("total_amount",s.target.value),placeholder:"0.00"}),c.total_amount&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:c.total_amount})]}),e.jsxs("div",{children:[e.jsx(r,{children:"Discount"}),e.jsx(p,{type:"number",step:"0.01",value:t.discount,onChange:s=>i("discount",s.target.value),placeholder:"0.00"})]}),e.jsxs("div",{children:[e.jsx(r,{children:"Advance Paid"}),e.jsx(p,{type:"number",step:"0.01",value:t.advance_paid,onChange:s=>i("advance_paid",s.target.value),placeholder:"0.00"})]})]}),e.jsxs("div",{children:[e.jsx(r,{children:"Payment Method"}),e.jsxs(m,{value:t.payment_method,onValueChange:s=>i("payment_method",s),children:[e.jsx(u,{children:e.jsx(h,{})}),e.jsxs(x,{children:[e.jsx(l,{value:"cash",children:"Cash"}),e.jsx(l,{value:"card",children:"Card"}),e.jsx(l,{value:"upi",children:"UPI"}),e.jsx(l,{value:"bank_transfer",children:"Bank Transfer"}),e.jsx(l,{value:"other",children:"Other"})]})]})]})]})]}),e.jsxs(g,{children:[e.jsx(v,{children:e.jsx(_,{children:"Dates & Additional Information"})}),e.jsxs(f,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx(r,{children:"Order Date *"}),e.jsxs(ee,{children:[e.jsx(se,{asChild:!0,children:e.jsxs(o,{variant:"outline",className:Y("w-full justify-start text-left font-normal",!t.order_date&&"text-muted-foreground"),children:[e.jsx(ie,{className:"mr-2 h-4 w-4"}),t.order_date?y(new Date(t.order_date),"PPP"):e.jsx("span",{children:"Pick a date"})]})}),e.jsx(te,{className:"w-auto p-0",children:e.jsx(ae,{mode:"single",selected:t.order_date?new Date(t.order_date):void 0,onSelect:s=>i("order_date",s?y(s,"yyyy-MM-dd"):""),initialFocus:!0})})]}),c.order_date&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:c.order_date})]}),e.jsxs("div",{children:[e.jsx(r,{children:"Delivery Date *"}),e.jsxs(ee,{children:[e.jsx(se,{asChild:!0,children:e.jsxs(o,{variant:"outline",className:Y("w-full justify-start text-left font-normal",!t.delivery_date&&"text-muted-foreground"),children:[e.jsx(ie,{className:"mr-2 h-4 w-4"}),t.delivery_date?y(new Date(t.delivery_date),"PPP"):e.jsx("span",{children:"Pick a date"})]})}),e.jsx(te,{className:"w-auto p-0",children:e.jsx(ae,{mode:"single",selected:t.delivery_date?new Date(t.delivery_date):void 0,onSelect:s=>i("delivery_date",s?y(s,"yyyy-MM-dd"):""),initialFocus:!0})})]}),c.delivery_date&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:c.delivery_date})]}),e.jsxs("div",{children:[e.jsx(r,{children:"Priority *"}),e.jsxs(m,{value:t.priority,onValueChange:s=>i("priority",s),children:[e.jsx(u,{children:e.jsx(h,{})}),e.jsxs(x,{children:[e.jsx(l,{value:"normal",children:"Normal"}),e.jsx(l,{value:"urgent",children:"Urgent"})]})]})]})]}),e.jsxs("div",{children:[e.jsx(r,{children:"Special Instructions"}),e.jsx(R,{value:t.special_instructions,onChange:s=>i("special_instructions",s.target.value),rows:3,placeholder:"Any special instructions for this order..."})]}),e.jsxs("div",{children:[e.jsx(r,{children:"Notes"}),e.jsx(R,{value:t.notes,onChange:s=>i("notes",s.target.value),rows:2,placeholder:"Internal notes..."})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(o,{type:"button",variant:"outline",onClick:()=>window.history.back(),children:"Cancel"}),e.jsx(o,{type:"submit",disabled:K,children:K?"Updating...":"Update Order"})]})]})]})]})}export{Ke as default};
