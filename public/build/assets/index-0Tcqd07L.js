import{d as O,r as j,j as e,t as y,c as D,H as B}from"./app-DBq1jQNZ.js";import{B as z,A as X}from"./app-layout-CNlFntjM.js";import{B as N}from"./app-logo-icon-8uBk2MJf.js";import{c as T,a as k,C as A,b as L}from"./card-BZT3r1Xm.js";import{c as S,b as C,D as $,a as P,d as V,f as I,e as K}from"./dialog-CdrbQtA5.js";import{u as U,a as W,o as G,c as J,s as R,n as Q,l as Y}from"./schemas-fhBe8mbs.js";import{I as w}from"./input-Cz0Yl_1W.js";import{L as v}from"./label-HnLZibk5.js";import{T as Z}from"./textarea-CYRFyVZr.js";import{C as ee}from"./checkbox-DO6RXVk2.js";import{S as se}from"./square-pen-DUfsB2k5.js";import{T as E}from"./trash-2-D4ZFeqBQ.js";import{P as q}from"./plus-ChZFlQW2.js";import{a as te,T as _,b as F,c as re}from"./tabs-DOac87TO.js";import{d as ae}from"./index-C4J_hXM0.js";/* empty css            */import"./index-DK3sQo0b.js";import"./index-C0xZon0J.js";import"./index-1D6xA_Pa.js";import"./check-BAFbYTHf.js";const g=O.create({baseURL:"/api",headers:{"Content-Type":"application/json",Accept:"application/json","X-Requested-With":"XMLHttpRequest"}});g.interceptors.request.use(r=>{const s=document.querySelector('meta[name="csrf-token"]')?.getAttribute("content");return s&&(r.headers["X-CSRF-TOKEN"]=s),r});const le=r=>g.post("/roles",r),ie=(r,s)=>g.put(`/roles/${r}`,s),oe=r=>g.delete(`/roles/${r}`),M=()=>g.get("/permissions"),ne=r=>g.post("/permissions",r),ce=r=>g.delete(`/permissions/${r}`),de=G({name:R().min(1,"Name is required").max(191),description:R().optional().or(Y("")),permissions:J(Q()).optional()});function H({onSubmit:r,loading:s,initialData:a}){const[l,i]=j.useState([]),[o,c]=j.useState(a?.permissions?.map(t=>t.id)||[]),{register:d,handleSubmit:m,formState:{errors:n}}=U({resolver:W(de),defaultValues:{name:a?.name||"",description:a?.description||""}});j.useEffect(()=>{h()},[]);const h=async()=>{try{const t=await M();i(t.data)}catch(t){console.error("Failed to fetch permissions:",t)}},b=t=>{c(x=>x.includes(t)?x.filter(f=>f!==t):[...x,t])},p=t=>{r({...t,permissions:o})};return e.jsxs("form",{onSubmit:m(p),className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(v,{htmlFor:"name",children:"Name *"}),e.jsx(w,{id:"name",...d("name"),className:n.name?"border-red-500":""}),n.name&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:n.name.message})]}),e.jsxs("div",{children:[e.jsx(v,{htmlFor:"description",children:"Description"}),e.jsx(Z,{id:"description",...d("description"),className:n.description?"border-red-500":""}),n.description&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:n.description.message})]}),e.jsxs("div",{children:[e.jsx(v,{children:"Permissions"}),e.jsx("div",{className:"space-y-2 mt-2 max-h-48 overflow-y-auto border rounded p-3",children:l.map(t=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ee,{id:`perm-${t.id}`,checked:o.includes(t.id),onCheckedChange:()=>b(t.id)}),e.jsxs("label",{htmlFor:`perm-${t.id}`,className:"text-sm cursor-pointer",children:[t.name," ",t.description&&`- ${t.description}`]})]},t.id))})]}),e.jsx(N,{type:"submit",disabled:s,className:"w-full",children:s?"Saving...":"Save Role"})]})}function me({role:r,open:s,onClose:a,onSuccess:l}){const[i,o]=j.useState(!1),c=async d=>{try{o(!0),await ie(r.id,d),y.success(`${r.name} updated successfully`),l()}catch(m){console.error("Failed to update role:",m),y.error("Failed to update role. Please try again.")}finally{o(!1)}};return e.jsx(S,{open:s,onOpenChange:a,children:e.jsxs(C,{className:"max-w-md max-h-[90vh] overflow-y-auto","aria-describedby":"role-edit-description",children:[e.jsx($,{children:e.jsx(P,{children:"Edit Role"})}),e.jsx("div",{id:"role-edit-description",className:"sr-only",children:"Form to edit role information and permissions"}),e.jsx(H,{onSubmit:c,loading:i,initialData:r})]})})}function he({role:r,open:s,onClose:a,onSuccess:l}){const[i,o]=j.useState(!1),c=async()=>{if(r)try{o(!0),await oe(r.id),y.success(`${r.name} has been successfully deleted`),l(),a()}catch(d){console.error("Failed to delete role:",d),y.error("Failed to delete role. Please try again.")}finally{o(!1)}};return e.jsx(S,{open:s,onOpenChange:a,children:e.jsxs(C,{"aria-describedby":"delete-role-description",children:[e.jsx(P,{children:"Are you sure you want to delete this role?"}),e.jsxs(V,{id:"delete-role-description",children:["Once deleted, ",r?.name," will be permanently removed. This action cannot be undone."]}),e.jsxs(I,{className:"gap-2",children:[e.jsx(K,{asChild:!0,children:e.jsx(N,{variant:"secondary",children:"Cancel"})}),e.jsx(N,{variant:"destructive",disabled:i,onClick:c,children:i?"Deleting...":"Delete Role"})]})]})})}function xe(r){const s=D.c(17),{roles:a}=r,[l,i]=j.useState(null),[o,c]=j.useState(null);if(!a||a.length===0){let u;return s[0]===Symbol.for("react.memo_cache_sentinel")?(u=e.jsx("div",{className:"text-center py-4",children:"No roles found"}),s[0]=u):u=s[0],u}let d;s[1]===Symbol.for("react.memo_cache_sentinel")?(d=e.jsx("thead",{children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"text-left p-4",children:"Name"}),e.jsx("th",{className:"text-left p-4",children:"Description"}),e.jsx("th",{className:"text-left p-4",children:"Permissions"}),e.jsx("th",{className:"text-left p-4",children:"Actions"})]})}),s[1]=d):d=s[1];let m;s[2]!==a?(m=Array.isArray(a)&&a.map(u=>e.jsxs("tr",{className:"border-b hover:bg-gray-50 dark:hover:bg-[oklch(0.269_0_0)]",children:[e.jsx("td",{className:"p-4 font-medium",children:u.name}),e.jsx("td",{className:"p-4 text-sm text-gray-600",children:u.description||"-"}),e.jsx("td",{className:"p-4",children:e.jsx("div",{className:"flex flex-wrap gap-1",children:u.permissions.map(ue)})}),e.jsx("td",{className:"p-4",children:e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(N,{size:"sm",variant:"outline",onClick:()=>i(u),children:e.jsx(se,{className:"h-4 w-4"})}),e.jsx(N,{size:"sm",variant:"outline",onClick:()=>c(u),children:e.jsx(E,{className:"h-4 w-4"})})]})})]},u.id)),s[2]=a,s[3]=m):m=s[3];let n;s[4]!==m?(n=e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full border-collapse",children:[d,e.jsx("tbody",{children:m})]})}),s[4]=m,s[5]=n):n=s[5];let h;s[6]!==l?(h=l&&e.jsx(me,{role:l,open:!!l,onClose:()=>i(null),onSuccess:()=>{i(null),window.location.reload()}}),s[6]=l,s[7]=h):h=s[7];const b=!!o;let p,t;s[8]===Symbol.for("react.memo_cache_sentinel")?(p=()=>c(null),t=()=>{c(null),window.location.reload()},s[8]=p,s[9]=t):(p=s[8],t=s[9]);let x;s[10]!==o||s[11]!==b?(x=e.jsx(he,{role:o,open:b,onClose:p,onSuccess:t}),s[10]=o,s[11]=b,s[12]=x):x=s[12];let f;return s[13]!==n||s[14]!==h||s[15]!==x?(f=e.jsxs(e.Fragment,{children:[n,h,x]}),s[13]=n,s[14]=h,s[15]=x,s[16]=f):f=s[16],f}function ue(r){return e.jsx(z,{variant:"secondary",children:r.name},r.id)}function pe({open:r,onClose:s}){const[a,l]=j.useState(!1),i=async o=>{try{l(!0),await le(o),y.success("Role created successfully"),s(),window.location.reload()}catch(c){console.error("Failed to create role:",c),y.error("Failed to create role. Please try again.")}finally{l(!1)}};return e.jsx(S,{open:r,onOpenChange:s,children:e.jsxs(C,{className:"max-w-md max-h-[90vh] overflow-y-auto","aria-describedby":"role-create-description",children:[e.jsx($,{children:e.jsx(P,{children:"Add New Role"})}),e.jsx("div",{id:"role-create-description",className:"sr-only",children:"Form to create a new role with permissions"}),e.jsx(H,{onSubmit:i,loading:a})]})})}function fe(){const[r,s]=j.useState([]),[a,l]=j.useState(!0),[i,o]=j.useState(""),[c,d]=j.useState(""),[m,n]=j.useState(!1),h=async()=>{try{l(!0);const t=await M();s(t.data)}catch(t){console.error("Failed to fetch permissions:",t)}finally{l(!1)}};j.useEffect(()=>{h()},[]);const b=async()=>{if(i.trim())try{n(!0),await ne({name:i,description:c}),y.success("Permission created successfully"),o(""),d(""),h()}catch(t){console.error("Failed to create permission:",t),y.error("Failed to create permission")}finally{n(!1)}},p=async(t,x)=>{try{await ce(t),y.success(`${x} deleted successfully`),h()}catch(f){console.error("Failed to delete permission:",f),y.error("Failed to delete permission")}};return a?e.jsx("div",{className:"text-center py-4",children:"Loading..."}):e.jsxs(T,{children:[e.jsx(k,{children:e.jsx(A,{children:"Permissions"})}),e.jsxs(L,{className:"space-y-4",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(w,{placeholder:"Permission name",value:i,onChange:t=>o(t.target.value)}),e.jsx(w,{placeholder:"Description (optional)",value:c,onChange:t=>d(t.target.value)}),e.jsxs(N,{onClick:b,disabled:m||!i.trim(),children:[e.jsx(q,{className:"h-4 w-4 mr-2"}),"Add"]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full border-collapse",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"text-left p-4",children:"Name"}),e.jsx("th",{className:"text-left p-4",children:"Description"}),e.jsx("th",{className:"text-left p-4",children:"Actions"})]})}),e.jsx("tbody",{children:r.map(t=>e.jsxs("tr",{className:"border-b hover:bg-gray-50 dark:hover:bg-[oklch(0.269_0_0)]",children:[e.jsx("td",{className:"p-4 font-medium",children:t.name}),e.jsx("td",{className:"p-4 text-sm text-gray-600",children:t.description||"-"}),e.jsx("td",{className:"p-4",children:e.jsx(N,{size:"sm",variant:"outline",onClick:()=>p(t.id,t.name),children:e.jsx(E,{className:"h-4 w-4"})})})]},t.id))})]})})]})]})}const je=[{title:"Dashboard",href:ae()},{title:"Roles & Permissions",href:"/roles"}];function Me(r){const s=D.c(18),{roles:a,permissions:l}=r,[i,o]=j.useState(!1);let c;s[0]===Symbol.for("react.memo_cache_sentinel")?(c=e.jsx(B,{title:"Roles & Permissions"}),s[0]=c):c=s[0];let d;s[1]===Symbol.for("react.memo_cache_sentinel")?(d=e.jsx("div",{className:"flex items-center justify-between",children:e.jsx("h1",{className:"text-3xl font-bold",children:"Roles & Permissions"})}),s[1]=d):d=s[1];let m;s[2]===Symbol.for("react.memo_cache_sentinel")?(m=e.jsxs(te,{children:[e.jsx(_,{value:"roles",children:"Roles"}),e.jsx(_,{value:"permissions",children:"Permissions"})]}),s[2]=m):m=s[2];let n;s[3]===Symbol.for("react.memo_cache_sentinel")?(n=e.jsx(A,{children:"Roles"}),s[3]=n):n=s[3];let h;s[4]===Symbol.for("react.memo_cache_sentinel")?(h=e.jsx(k,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[n,e.jsxs(N,{onClick:()=>o(!0),children:[e.jsx(q,{className:"h-4 w-4 mr-2"}),"Add Role"]})]})}),s[4]=h):h=s[4];let b;s[5]!==a?(b=e.jsx(F,{value:"roles",children:e.jsxs(T,{children:[h,e.jsx(L,{children:e.jsx(xe,{roles:a})})]})}),s[5]=a,s[6]=b):b=s[6];let p;s[7]!==l?(p=e.jsx(F,{value:"permissions",children:e.jsx(fe,{permissions:l})}),s[7]=l,s[8]=p):p=s[8];let t;s[9]!==b||s[10]!==p?(t=e.jsxs(re,{defaultValue:"roles",className:"w-full",children:[m,b,p]}),s[9]=b,s[10]=p,s[11]=t):t=s[11];let x;s[12]===Symbol.for("react.memo_cache_sentinel")?(x=()=>o(!1),s[12]=x):x=s[12];let f;s[13]!==i?(f=e.jsx(pe,{open:i,onClose:x}),s[13]=i,s[14]=f):f=s[14];let u;return s[15]!==f||s[16]!==t?(u=e.jsxs(X,{breadcrumbs:je,children:[c,e.jsxs("div",{className:"space-y-6 p-4",children:[d,t,f]})]}),s[15]=f,s[16]=t,s[17]=u):u=s[17],u}export{Me as default};
