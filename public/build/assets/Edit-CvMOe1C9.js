import{r as d,u as ve,d as _e,j as e,H as fe,t as X}from"./app-eDs_-Mho.js";import{A as be,C as ye,b as q,c as D,d as R}from"./app-layout-CN1B5ki9.js";import{B as o,c as Y}from"./app-logo-icon-DgyrohKX.js";import{I as j}from"./input-Da_4aK0I.js";import{L as i}from"./label-BD5n0dY2.js";import{T as U}from"./textarea-CSCru5x8.js";import{S as m,a as u,b as h,c as x,d as l,C as Ne}from"./select-B8NPCyUk.js";import{c as p,a as g,C as v,b as _}from"./card-Di9wNz-y.js";import{C as Z}from"./checkbox-CeyjE1x1.js";import{R as Ce,a as I,I as O}from"./radio-group-CdiUeHr5.js";import{b as ee,P as se,f as b,a as te,C as ae}from"./popover-VAv_VboN.js";import{C as T}from"./camera-Cl816Rhx.js";import{T as G}from"./trash-2-HPGYmrKE.js";import{C as ie}from"./calendar-TgLSsUYa.js";/* empty css            */import"./index-Drp0UAxW.js";import"./index-DZaLwZun.js";import"./index-C4J_hXM0.js";import"./index-C3lxKgUK.js";import"./check-QypyNZ-N.js";import"./en-US-BDqzE9Ni.js";import"./chevron-left-D4U_WPVf.js";function Je({order:r,customers:re,garmentTypes:ne,tailors:le,fabrics:ce,statuses:de,categories:L=[]}){const[y,A]=d.useState([]),[f,oe]=d.useState("skip"),[N,C]=d.useState(!1),[w,me]=d.useState({}),[V,ue]=d.useState(""),[S,B]=d.useState(r.design_image||null),[P,E]=d.useState(r.customer_fabric_photo||null),[k,z]=d.useState(r.boutique_fabric_photo||null),$=d.useRef(null),H=d.useRef(null),J=d.useRef(null),{data:t,setData:a,put:he,processing:K,errors:c}=ve({customer_id:r.customer_id.toString(),garment_type_id:r.garment_type_id.toString(),tailor_id:r.tailor_id.toString(),measurement_id:r.measurement_id?.toString()||"",measurement_option:"skip",new_measurement_type:"",new_measurements:{},measurement_notes:"",fabric_id:r.fabric_id?.toString()||"",customer_fabric:r.customer_fabric||!1,boutique_fabric:r.boutique_fabric||!1,customer_fabric_photo:null,boutique_fabric_photo:null,design_image:null,payment_method:"cash",stitching_status_id:r.stitching_status_id.toString(),order_date:r.order_date,delivery_date:r.delivery_date,priority:r.priority,total_amount:r.total_amount.toString(),advance_paid:r.advance_paid?.toString()||"",discount:r.discount.toString(),special_instructions:r.special_instructions||"",notes:r.notes||""});d.useEffect(()=>{r.customer_id&&Q(r.customer_id.toString())},[]);const Q=async s=>{if(s)try{const n=await _e.get(`/api/measurements?customer_id=${s}`);A(n.data)}catch(n){console.error("Failed to fetch measurements:",n)}else A([])},xe=async s=>{a("customer_id",s),Q(s)},je=s=>{oe(s),a("measurement_option",s),C(s==="new")},M=L?.find(s=>s.slug===V),pe=s=>{s.preventDefault();const n={...t,new_measurements:f==="new"?w:{}};he(`/orders/${r.id}`,{data:n,onSuccess:()=>{X.success("Order updated successfully")},onError:()=>{X.error("Failed to update order")}})};return e.jsxs(be,{children:[e.jsx(fe,{title:`Edit Order ${r.order_number}`}),e.jsxs("div",{className:"space-y-6 p-4 max-w-6xl mx-auto",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("h1",{className:"text-3xl font-bold",children:["Edit Order ",r.order_number]})}),e.jsxs("form",{onSubmit:pe,className:"space-y-6",children:[e.jsxs(p,{children:[e.jsx(g,{children:e.jsx(v,{children:"Order Details"})}),e.jsx(_,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(i,{children:"Customer *"}),e.jsxs(m,{value:t.customer_id,onValueChange:xe,children:[e.jsx(u,{children:e.jsx(h,{placeholder:"Select customer"})}),e.jsxs(x,{children:[e.jsx("div",{className:"px-2 pb-2 sticky top-0 bg-popover z-10",children:e.jsx(j,{placeholder:"Search customer...",className:"h-8",onChange:s=>{const n=s.target.value.toLowerCase();document.querySelectorAll("[data-customer-item]").forEach(W=>{const ge=W.textContent?.toLowerCase()||"";W.style.display=ge.includes(n)?"":"none"})},onKeyDown:s=>s.stopPropagation()})}),re.map(s=>e.jsx(l,{value:s.id.toString(),"data-customer-item":!0,children:s.name},s.id))]})]}),c.customer_id&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:c.customer_id})]}),e.jsxs("div",{children:[e.jsx(i,{children:"Garment Type *"}),e.jsxs(m,{value:t.garment_type_id,onValueChange:s=>a("garment_type_id",s),children:[e.jsx(u,{children:e.jsx(h,{placeholder:"Select garment type"})}),e.jsx(x,{children:ne.map(s=>e.jsx(l,{value:s.id.toString(),children:s.name},s.id))})]}),c.garment_type_id&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:c.garment_type_id})]}),e.jsxs("div",{children:[e.jsx(i,{children:"Tailor *"}),e.jsxs(m,{value:t.tailor_id,onValueChange:s=>a("tailor_id",s),children:[e.jsx(u,{children:e.jsx(h,{placeholder:"Select tailor"})}),e.jsx(x,{children:le.map(s=>e.jsx(l,{value:s.id.toString(),children:s.name},s.id))})]}),c.tailor_id&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:c.tailor_id})]}),e.jsxs("div",{children:[e.jsx(i,{children:"Status *"}),e.jsxs(m,{value:t.stitching_status_id,onValueChange:s=>a("stitching_status_id",s),children:[e.jsx(u,{children:e.jsx(h,{})}),e.jsx(x,{children:de.map(s=>e.jsx(l,{value:s.id.toString(),children:s.name},s.id))})]})]})]})})]}),t.customer_id&&e.jsxs(p,{children:[e.jsx(g,{children:e.jsx(v,{children:"Measurements"})}),e.jsxs(_,{className:"space-y-4",children:[e.jsxs(Ce,{value:f,onValueChange:je,children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(I,{value:"skip",id:"skip"}),e.jsx(i,{htmlFor:"skip",className:"cursor-pointer",children:"Skip measurements"})]}),y.length>0&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(I,{value:"existing",id:"existing"}),e.jsx(i,{htmlFor:"existing",className:"cursor-pointer",children:"Use existing measurement"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(I,{value:"new",id:"new"}),e.jsx(i,{htmlFor:"new",className:"cursor-pointer",children:"Create new measurement"})]})]}),f==="existing"&&y.length>0&&e.jsxs("div",{children:[e.jsx(i,{children:"Select Measurement"}),e.jsxs(m,{value:t.measurement_id,onValueChange:s=>a("measurement_id",s),children:[e.jsx(u,{children:e.jsx(h,{placeholder:"Select measurement"})}),e.jsx(x,{children:y.map(s=>e.jsxs(l,{value:s.id.toString(),children:[s.measurement_type," - ",new Date(s.created_at).toLocaleDateString()]},s.id))})]})]}),f==="new"&&e.jsxs("div",{className:"space-y-4 border-t pt-4",children:[e.jsxs("div",{children:[e.jsx(i,{children:"Measurement Type *"}),e.jsxs(m,{value:V,onValueChange:s=>{ue(s),a("new_measurement_type",s)},children:[e.jsx(u,{children:e.jsx(h,{placeholder:"Select measurement type"})}),e.jsx(x,{children:L?.map(s=>e.jsx(l,{value:s.slug,children:s.name},s.id))||[]})]})]}),M&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(i,{className:"text-base font-semibold",children:[M.name," Measurements"]}),e.jsx(o,{type:"button",variant:"ghost",size:"sm",onClick:()=>C(!N),children:N?e.jsx(Ne,{className:"h-4 w-4"}):e.jsx(ye,{className:"h-4 w-4"})})]}),N&&e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4 p-4 bg-gray-50 rounded-lg",children:M.fields.map(s=>e.jsxs("div",{children:[e.jsxs(i,{htmlFor:s.slug,className:"text-sm",children:[s.name," (",s.unit,")",s.is_required&&e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),e.jsx(j,{id:s.slug,type:"number",step:"0.1",placeholder:"0.0",value:w[s.slug]||"",onChange:n=>{const F={...w,[s.slug]:n.target.value};me(F),a("new_measurements",F)},required:s.is_required})]},s.id))}),e.jsxs("div",{children:[e.jsx(i,{children:"Measurement Notes"}),e.jsx(U,{value:t.measurement_notes,onChange:s=>a("measurement_notes",s.target.value),rows:2,placeholder:"Any special notes about measurements..."})]})]})]})]})]}),e.jsxs(p,{children:[e.jsx(g,{children:e.jsx(v,{children:"Fabric & Design"})}),e.jsxs(_,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Z,{id:"customer_fabric",checked:t.customer_fabric,onCheckedChange:s=>a("customer_fabric",s)}),e.jsx("label",{htmlFor:"customer_fabric",className:"text-sm cursor-pointer",children:"Customer provided fabric"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Z,{id:"boutique_fabric",checked:t.boutique_fabric,onCheckedChange:s=>a("boutique_fabric",s)}),e.jsx("label",{htmlFor:"boutique_fabric",className:"text-sm cursor-pointer",children:"Boutique provided fabric"})]})]}),t.boutique_fabric&&e.jsxs("div",{children:[e.jsx(i,{children:"Fabric"}),e.jsxs(m,{value:t.fabric_id,onValueChange:s=>a("fabric_id",s),children:[e.jsx(u,{children:e.jsx(h,{placeholder:"Select fabric"})}),e.jsx(x,{children:ce.map(s=>e.jsxs(l,{value:s.id.toString(),children:[s.name," - $",s.price_per_meter,"/meter"]},s.id))})]})]}),t.boutique_fabric&&e.jsxs("div",{children:[e.jsx(i,{children:"Boutique Fabric Photo"}),e.jsxs("div",{className:"flex items-center gap-4 mt-2",children:[e.jsxs(q,{className:"h-24 w-24 rounded-md",children:[e.jsx(D,{src:k||void 0,alt:"Boutique Fabric",className:"object-cover"}),e.jsx(R,{className:"rounded-md bg-muted",children:e.jsx(O,{className:"h-8 w-8 text-muted-foreground"})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(o,{type:"button",variant:"outline",size:"sm",onClick:()=>J.current?.click(),children:[e.jsx(T,{className:"h-4 w-4 mr-2"}),k?"Change":"Upload"]}),k&&e.jsxs(o,{type:"button",variant:"outline",size:"sm",onClick:()=>{z(null),a("boutique_fabric_photo",null)},children:[e.jsx(G,{className:"h-4 w-4 mr-2"}),"Remove"]})]})]}),e.jsx("input",{ref:J,type:"file",accept:"image/*",onChange:s=>{const n=s.target.files?.[0];n&&(a("boutique_fabric_photo",n),z(URL.createObjectURL(n)))},className:"hidden"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"Upload boutique fabric photo (JPG, PNG or GIF. Max 2MB)"})]}),t.customer_fabric&&e.jsxs("div",{children:[e.jsx(i,{children:"Customer Fabric Photo"}),e.jsxs("div",{className:"flex items-center gap-4 mt-2",children:[e.jsxs(q,{className:"h-24 w-24 rounded-md",children:[e.jsx(D,{src:P||void 0,alt:"Fabric",className:"object-cover"}),e.jsx(R,{className:"rounded-md bg-muted",children:e.jsx(O,{className:"h-8 w-8 text-muted-foreground"})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(o,{type:"button",variant:"outline",size:"sm",onClick:()=>H.current?.click(),children:[e.jsx(T,{className:"h-4 w-4 mr-2"}),P?"Change":"Upload"]}),P&&e.jsxs(o,{type:"button",variant:"outline",size:"sm",onClick:()=>{E(null),a("customer_fabric_photo",null)},children:[e.jsx(G,{className:"h-4 w-4 mr-2"}),"Remove"]})]})]}),e.jsx("input",{ref:H,type:"file",accept:"image/*",onChange:s=>{const n=s.target.files?.[0];n&&(a("customer_fabric_photo",n),E(URL.createObjectURL(n)))},className:"hidden"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"Upload customer fabric photo (JPG, PNG or GIF. Max 2MB)"})]}),e.jsxs("div",{children:[e.jsx(i,{children:"Design Image"}),e.jsxs("div",{className:"flex items-center gap-4 mt-2",children:[e.jsxs(q,{className:"h-24 w-24 rounded-md",children:[e.jsx(D,{src:S||void 0,alt:"Design",className:"object-cover"}),e.jsx(R,{className:"rounded-md bg-muted",children:e.jsx(O,{className:"h-8 w-8 text-muted-foreground"})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(o,{type:"button",variant:"outline",size:"sm",onClick:()=>$.current?.click(),children:[e.jsx(T,{className:"h-4 w-4 mr-2"}),S?"Change":"Upload"]}),S&&e.jsxs(o,{type:"button",variant:"outline",size:"sm",onClick:()=>{B(null),a("design_image",null)},children:[e.jsx(G,{className:"h-4 w-4 mr-2"}),"Remove"]})]})]}),e.jsx("input",{ref:$,type:"file",accept:"image/*",onChange:s=>{const n=s.target.files?.[0];n&&(a("design_image",n),B(URL.createObjectURL(n)))},className:"hidden"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"Upload design reference image (JPG, PNG or GIF. Max 2MB)"})]})]})]}),e.jsxs(p,{children:[e.jsx(g,{children:e.jsx(v,{children:"Pricing & Payment"})}),e.jsxs(_,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx(i,{children:"Total Amount *"}),e.jsx(j,{type:"number",step:"0.01",value:t.total_amount,onChange:s=>a("total_amount",s.target.value),placeholder:"0.00"}),c.total_amount&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:c.total_amount})]}),e.jsxs("div",{children:[e.jsx(i,{children:"Discount"}),e.jsx(j,{type:"number",step:"0.01",value:t.discount,onChange:s=>a("discount",s.target.value),placeholder:"0.00"})]}),e.jsxs("div",{children:[e.jsx(i,{children:"Advance Paid"}),e.jsx(j,{type:"number",step:"0.01",value:t.advance_paid,onChange:s=>a("advance_paid",s.target.value),placeholder:"0.00"})]})]}),e.jsxs("div",{children:[e.jsx(i,{children:"Payment Method"}),e.jsxs(m,{value:t.payment_method,onValueChange:s=>a("payment_method",s),children:[e.jsx(u,{children:e.jsx(h,{})}),e.jsxs(x,{children:[e.jsx(l,{value:"cash",children:"Cash"}),e.jsx(l,{value:"card",children:"Card"}),e.jsx(l,{value:"upi",children:"UPI"}),e.jsx(l,{value:"bank_transfer",children:"Bank Transfer"}),e.jsx(l,{value:"other",children:"Other"})]})]})]})]})]}),e.jsxs(p,{children:[e.jsx(g,{children:e.jsx(v,{children:"Dates & Additional Information"})}),e.jsxs(_,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx(i,{children:"Order Date *"}),e.jsxs(ee,{children:[e.jsx(se,{asChild:!0,children:e.jsxs(o,{variant:"outline",className:Y("w-full justify-start text-left font-normal",!t.order_date&&"text-muted-foreground"),children:[e.jsx(ie,{className:"mr-2 h-4 w-4"}),t.order_date?b(new Date(t.order_date),"PPP"):e.jsx("span",{children:"Pick a date"})]})}),e.jsx(te,{className:"w-auto p-0",children:e.jsx(ae,{mode:"single",selected:t.order_date?new Date(t.order_date):void 0,onSelect:s=>a("order_date",s?b(s,"yyyy-MM-dd"):""),initialFocus:!0})})]}),c.order_date&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:c.order_date})]}),e.jsxs("div",{children:[e.jsx(i,{children:"Delivery Date *"}),e.jsxs(ee,{children:[e.jsx(se,{asChild:!0,children:e.jsxs(o,{variant:"outline",className:Y("w-full justify-start text-left font-normal",!t.delivery_date&&"text-muted-foreground"),children:[e.jsx(ie,{className:"mr-2 h-4 w-4"}),t.delivery_date?b(new Date(t.delivery_date),"PPP"):e.jsx("span",{children:"Pick a date"})]})}),e.jsx(te,{className:"w-auto p-0",children:e.jsx(ae,{mode:"single",selected:t.delivery_date?new Date(t.delivery_date):void 0,onSelect:s=>a("delivery_date",s?b(s,"yyyy-MM-dd"):""),initialFocus:!0})})]}),c.delivery_date&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:c.delivery_date})]}),e.jsxs("div",{children:[e.jsx(i,{children:"Priority *"}),e.jsxs(m,{value:t.priority,onValueChange:s=>a("priority",s),children:[e.jsx(u,{children:e.jsx(h,{})}),e.jsxs(x,{children:[e.jsx(l,{value:"normal",children:"Normal"}),e.jsx(l,{value:"urgent",children:"Urgent"})]})]})]})]}),e.jsxs("div",{children:[e.jsx(i,{children:"Special Instructions"}),e.jsx(U,{value:t.special_instructions,onChange:s=>a("special_instructions",s.target.value),rows:3,placeholder:"Any special instructions for this order..."})]}),e.jsxs("div",{children:[e.jsx(i,{children:"Notes"}),e.jsx(U,{value:t.notes,onChange:s=>a("notes",s.target.value),rows:2,placeholder:"Internal notes..."})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(o,{type:"button",variant:"outline",onClick:()=>window.history.back(),children:"Cancel"}),e.jsx(o,{type:"submit",disabled:K,children:K?"Updating...":"Update Order"})]})]})]})]})}export{Je as default};
