import{d as Y,r as x,j as e,t as y,c as I,H}from"./app-s6NgXo84.js";import{B as Z,A as O}from"./app-layout-MdC0vklR.js";import{B as g}from"./app-logo-icon-B0fBNtIv.js";import{c as k,a as A,C as K,b as L}from"./card-DnZVNnqQ.js";import{c as E,b as q,D as U,a as M,d as ee,f as se,e as te}from"./dialog-C3gyF7XN.js";import{u as ae,a as le,o as re,c as ie,s as B,n as oe,l as ne}from"./schemas-Bl3fSuCC.js";import{I as $}from"./input-DxU08Nhu.js";import{L as T}from"./label-CphVOY8c.js";import{T as ce}from"./textarea-CKvZM8xf.js";import{C as de}from"./checkbox-D2FCCmvd.js";import{S as me}from"./square-pen-CiBZ44MO.js";import{T as W}from"./trash-2-BeV3y9ve.js";import{P as G}from"./plus-DOT8cK_l.js";import{a as he,T as z,b as X,c as xe}from"./tabs-D2FjBNkX.js";import{S as j}from"./skeleton-CTqK9_9c.js";/* empty css            */import"./index-_mjGiuzX.js";import"./index-COLmkTQT.js";import"./index-Cm2o4msX.js";import"./index-D3q0pOp_.js";import"./check-GKsih9Bs.js";const w=Y.create({baseURL:"/api",headers:{"Content-Type":"application/json",Accept:"application/json","X-Requested-With":"XMLHttpRequest"}});w.interceptors.request.use(a=>{const s=document.querySelector('meta[name="csrf-token"]')?.getAttribute("content");return s&&(a.headers["X-CSRF-TOKEN"]=s),a});const ue=a=>w.post("/roles",a),fe=(a,s)=>w.put(`/roles/${a}`,s),je=a=>w.delete(`/roles/${a}`),J=()=>w.get("/permissions"),pe=a=>w.post("/permissions",a),Ne=a=>w.delete(`/permissions/${a}`),be=re({name:B().min(1,"Name is required").max(191),description:B().optional().or(ne("")),permissions:ie(oe()).optional()});function Q({onSubmit:a,loading:s,initialData:l}){const[r,i]=x.useState([]),[o,u]=x.useState(l?.permissions?.map(t=>t.id)||[]),{register:f,handleSubmit:m,formState:{errors:n}}=ae({resolver:le(be),defaultValues:{name:l?.name||"",description:l?.description||""}});x.useEffect(()=>{h()},[]);const h=async()=>{try{const t=await J();i(t.data)}catch(t){console.error("Failed to fetch permissions:",t)}},b=t=>{u(c=>c.includes(t)?c.filter(p=>p!==t):[...c,t])},N=t=>{a({...t,permissions:o})};return e.jsxs("form",{onSubmit:m(N),className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(T,{htmlFor:"name",children:"Name *"}),e.jsx($,{id:"name",...f("name"),className:n.name?"border-red-500":""}),n.name&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:n.name.message})]}),e.jsxs("div",{children:[e.jsx(T,{htmlFor:"description",children:"Description"}),e.jsx(ce,{id:"description",...f("description"),className:n.description?"border-red-500":""}),n.description&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:n.description.message})]}),e.jsxs("div",{children:[e.jsx(T,{children:"Permissions"}),e.jsx("div",{className:"space-y-2 mt-2 max-h-48 overflow-y-auto border rounded p-3",children:r.map(t=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(de,{id:`perm-${t.id}`,checked:o.includes(t.id),onCheckedChange:()=>b(t.id)}),e.jsxs("label",{htmlFor:`perm-${t.id}`,className:"text-sm cursor-pointer",children:[t.name," ",t.description&&`- ${t.description}`]})]},t.id))})]}),e.jsx(g,{type:"submit",disabled:s,className:"w-full",children:s?"Saving...":"Save Role"})]})}function ye({role:a,open:s,onClose:l,onSuccess:r}){const[i,o]=x.useState(!1),u=async f=>{try{o(!0),await fe(a.id,f),y.success(`${a.name} updated successfully`),r()}catch(m){console.error("Failed to update role:",m),y.error("Failed to update role. Please try again.")}finally{o(!1)}};return e.jsx(E,{open:s,onOpenChange:l,children:e.jsxs(q,{className:"max-w-md max-h-[90vh] overflow-y-auto","aria-describedby":"role-edit-description",children:[e.jsx(U,{children:e.jsx(M,{children:"Edit Role"})}),e.jsx("div",{id:"role-edit-description",className:"sr-only",children:"Form to edit role information and permissions"}),e.jsx(Q,{onSubmit:u,loading:i,initialData:a})]})})}function ge({role:a,open:s,onClose:l,onSuccess:r}){const[i,o]=x.useState(!1),u=async()=>{if(a)try{o(!0),await je(a.id),y.success(`${a.name} has been successfully deleted`),r(),l()}catch(f){console.error("Failed to delete role:",f),y.error("Failed to delete role. Please try again.")}finally{o(!1)}};return e.jsx(E,{open:s,onOpenChange:l,children:e.jsxs(q,{"aria-describedby":"delete-role-description",children:[e.jsx(M,{children:"Are you sure you want to delete this role?"}),e.jsxs(ee,{id:"delete-role-description",children:["Once deleted, ",a?.name," will be permanently removed. This action cannot be undone."]}),e.jsxs(se,{className:"gap-2",children:[e.jsx(te,{asChild:!0,children:e.jsx(g,{variant:"secondary",children:"Cancel"})}),e.jsx(g,{variant:"destructive",disabled:i,onClick:u,children:i?"Deleting...":"Delete Role"})]})]})})}function we(a){const s=I.c(17),{roles:l}=a,[r,i]=x.useState(null),[o,u]=x.useState(null);if(!l||l.length===0){let d;return s[0]===Symbol.for("react.memo_cache_sentinel")?(d=e.jsx("div",{className:"text-center py-4",children:"No roles found"}),s[0]=d):d=s[0],d}let f;s[1]===Symbol.for("react.memo_cache_sentinel")?(f=e.jsx("thead",{children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"text-left p-4",children:"Name"}),e.jsx("th",{className:"text-left p-4",children:"Description"}),e.jsx("th",{className:"text-left p-4",children:"Permissions"}),e.jsx("th",{className:"text-left p-4",children:"Actions"})]})}),s[1]=f):f=s[1];let m;s[2]!==l?(m=Array.isArray(l)&&l.map(d=>e.jsxs("tr",{className:"border-b hover:bg-gray-50 dark:hover:bg-[oklch(0.269_0_0)]",children:[e.jsx("td",{className:"p-4 font-medium",children:d.name}),e.jsx("td",{className:"p-4 text-sm text-gray-600",children:d.description||"-"}),e.jsx("td",{className:"p-4",children:e.jsx("div",{className:"flex flex-wrap gap-1",children:d.permissions.map(ve)})}),e.jsx("td",{className:"p-4",children:e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(g,{size:"sm",variant:"outline",onClick:()=>i(d),children:e.jsx(me,{className:"h-4 w-4"})}),e.jsx(g,{size:"sm",variant:"outline",onClick:()=>u(d),children:e.jsx(W,{className:"h-4 w-4"})})]})})]},d.id)),s[2]=l,s[3]=m):m=s[3];let n;s[4]!==m?(n=e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full border-collapse",children:[f,e.jsx("tbody",{children:m})]})}),s[4]=m,s[5]=n):n=s[5];let h;s[6]!==r?(h=r&&e.jsx(ye,{role:r,open:!!r,onClose:()=>i(null),onSuccess:()=>{i(null),window.location.reload()}}),s[6]=r,s[7]=h):h=s[7];const b=!!o;let N,t;s[8]===Symbol.for("react.memo_cache_sentinel")?(N=()=>u(null),t=()=>{u(null),window.location.reload()},s[8]=N,s[9]=t):(N=s[8],t=s[9]);let c;s[10]!==o||s[11]!==b?(c=e.jsx(ge,{role:o,open:b,onClose:N,onSuccess:t}),s[10]=o,s[11]=b,s[12]=c):c=s[12];let p;return s[13]!==n||s[14]!==h||s[15]!==c?(p=e.jsxs(e.Fragment,{children:[n,h,c]}),s[13]=n,s[14]=h,s[15]=c,s[16]=p):p=s[16],p}function ve(a){return e.jsx(Z,{variant:"secondary",children:a.name},a.id)}function Se({open:a,onClose:s}){const[l,r]=x.useState(!1),i=async o=>{try{r(!0),await ue(o),y.success("Role created successfully"),s(),window.location.reload()}catch(u){console.error("Failed to create role:",u),y.error("Failed to create role. Please try again.")}finally{r(!1)}};return e.jsx(E,{open:a,onOpenChange:s,children:e.jsxs(q,{className:"max-w-md max-h-[90vh] overflow-y-auto","aria-describedby":"role-create-description",children:[e.jsx(U,{children:e.jsx(M,{children:"Add New Role"})}),e.jsx("div",{id:"role-create-description",className:"sr-only",children:"Form to create a new role with permissions"}),e.jsx(Q,{onSubmit:i,loading:l})]})})}function _e(){const[a,s]=x.useState([]),[l,r]=x.useState(!0),[i,o]=x.useState(""),[u,f]=x.useState(""),[m,n]=x.useState(!1),h=async()=>{try{r(!0);const t=await J();s(t.data)}catch(t){console.error("Failed to fetch permissions:",t)}finally{r(!1)}};x.useEffect(()=>{h()},[]);const b=async()=>{if(i.trim())try{n(!0),await pe({name:i,description:u}),y.success("Permission created successfully"),o(""),f(""),h()}catch(t){console.error("Failed to create permission:",t),y.error("Failed to create permission")}finally{n(!1)}},N=async(t,c)=>{try{await Ne(t),y.success(`${c} deleted successfully`),h()}catch(p){console.error("Failed to delete permission:",p),y.error("Failed to delete permission")}};return l?e.jsx("div",{className:"text-center py-4",children:"Loading..."}):e.jsxs(k,{children:[e.jsx(A,{children:e.jsx(K,{children:"Permissions"})}),e.jsxs(L,{className:"space-y-4",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx($,{placeholder:"Permission name",value:i,onChange:t=>o(t.target.value)}),e.jsx($,{placeholder:"Description (optional)",value:u,onChange:t=>f(t.target.value)}),e.jsxs(g,{onClick:b,disabled:m||!i.trim(),children:[e.jsx(G,{className:"h-4 w-4 mr-2"}),"Add"]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full border-collapse",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"text-left p-4",children:"Name"}),e.jsx("th",{className:"text-left p-4",children:"Description"}),e.jsx("th",{className:"text-left p-4",children:"Actions"})]})}),e.jsx("tbody",{children:a.map(t=>e.jsxs("tr",{className:"border-b hover:bg-gray-50 dark:hover:bg-[oklch(0.269_0_0)]",children:[e.jsx("td",{className:"p-4 font-medium",children:t.name}),e.jsx("td",{className:"p-4 text-sm text-gray-600",children:t.description||"-"}),e.jsx("td",{className:"p-4",children:e.jsx(g,{size:"sm",variant:"outline",onClick:()=>N(t.id,t.name),children:e.jsx(W,{className:"h-4 w-4"})})})]},t.id))})]})})]})]})}const V=[{title:"Roles & Permissions",href:"/roles"}];function We(a){const s=I.c(24),{roles:l,permissions:r}=a,[i,o]=x.useState(!1),[u,f]=x.useState(!0);let m;if(s[0]===Symbol.for("react.memo_cache_sentinel")?(m=()=>{const S=setTimeout(()=>f(!1),1e3);return()=>clearTimeout(S)},s[0]=m):m=s[0],x.useState(m),u){let S;s[1]===Symbol.for("react.memo_cache_sentinel")?(S=e.jsx(H,{title:"Roles & Permissions"}),s[1]=S):S=s[1];let P;s[2]===Symbol.for("react.memo_cache_sentinel")?(P=e.jsx("div",{className:"flex items-center justify-between",children:e.jsx(j,{className:"h-9 w-64"})}),s[2]=P):P=s[2];let R;s[3]===Symbol.for("react.memo_cache_sentinel")?(R=e.jsxs("div",{className:"flex space-x-1 mb-6",children:[e.jsx(j,{className:"h-10 w-16"}),e.jsx(j,{className:"h-10 w-24"})]}),s[3]=R):R=s[3];let F;s[4]===Symbol.for("react.memo_cache_sentinel")?(F=e.jsx(A,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(j,{className:"h-6 w-16"}),e.jsx(j,{className:"h-10 w-24"})]})}),s[4]=F):F=s[4];let D;return s[5]===Symbol.for("react.memo_cache_sentinel")?(D=e.jsxs(O,{breadcrumbs:V,children:[S,e.jsxs("div",{className:"space-y-6 p-4",children:[P,e.jsxs("div",{className:"w-full",children:[R,e.jsxs(k,{children:[F,e.jsxs(L,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-4 gap-4 pb-2 border-b",children:[e.jsx(j,{className:"h-4 w-12"}),e.jsx(j,{className:"h-4 w-20"}),e.jsx(j,{className:"h-4 w-24"}),e.jsx(j,{className:"h-4 w-16"})]}),[...Array(5)].map(Ce)]})]})]})]})]}),s[5]=D):D=s[5],D}let n;s[6]===Symbol.for("react.memo_cache_sentinel")?(n=e.jsx(H,{title:"Roles & Permissions"}),s[6]=n):n=s[6];let h;s[7]===Symbol.for("react.memo_cache_sentinel")?(h=e.jsx("div",{className:"flex items-center justify-between",children:e.jsx("h1",{className:"text-3xl font-bold",children:"Roles & Permissions"})}),s[7]=h):h=s[7];let b;s[8]===Symbol.for("react.memo_cache_sentinel")?(b=e.jsxs(he,{children:[e.jsx(z,{value:"roles",children:"Roles"}),e.jsx(z,{value:"permissions",children:"Permissions"})]}),s[8]=b):b=s[8];let N;s[9]===Symbol.for("react.memo_cache_sentinel")?(N=e.jsx(K,{children:"Roles"}),s[9]=N):N=s[9];let t;s[10]===Symbol.for("react.memo_cache_sentinel")?(t=e.jsx(A,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[N,e.jsxs(g,{onClick:()=>o(!0),children:[e.jsx(G,{className:"h-4 w-4 mr-2"}),"Add Role"]})]})}),s[10]=t):t=s[10];let c;s[11]!==l?(c=e.jsx(X,{value:"roles",children:e.jsxs(k,{children:[t,e.jsx(L,{children:e.jsx(we,{roles:l})})]})}),s[11]=l,s[12]=c):c=s[12];let p;s[13]!==r?(p=e.jsx(X,{value:"permissions",children:e.jsx(_e,{permissions:r})}),s[13]=r,s[14]=p):p=s[14];let d;s[15]!==c||s[16]!==p?(d=e.jsxs(xe,{defaultValue:"roles",className:"w-full",children:[b,c,p]}),s[15]=c,s[16]=p,s[17]=d):d=s[17];let _;s[18]===Symbol.for("react.memo_cache_sentinel")?(_=()=>o(!1),s[18]=_):_=s[18];let v;s[19]!==i?(v=e.jsx(Se,{open:i,onClose:_}),s[19]=i,s[20]=v):v=s[20];let C;return s[21]!==v||s[22]!==d?(C=e.jsxs(O,{breadcrumbs:V,children:[n,e.jsxs("div",{className:"space-y-6 p-4",children:[h,d,v]})]}),s[21]=v,s[22]=d,s[23]=C):C=s[23],C}function Ce(a,s){return e.jsxs("div",{className:"grid grid-cols-4 gap-4 py-3 border-b",children:[e.jsx(j,{className:"h-4 w-16"}),e.jsx(j,{className:"h-4 w-32"}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx(j,{className:"h-5 w-12"}),e.jsx(j,{className:"h-5 w-16"}),e.jsx(j,{className:"h-5 w-14"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(j,{className:"h-8 w-8"}),e.jsx(j,{className:"h-8 w-8"})]})]},s)}export{We as default};
