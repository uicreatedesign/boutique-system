import{r as d,u as ge,d as _e,j as e,H as ve,t as W}from"./app-X0TVhyfm.js";import{A as fe,C as be,b as k,c as F,d as q}from"./app-layout-DMq1wZB-.js";import{B as o,c as X}from"./app-logo-icon-B4euW0No.js";import{I as y}from"./input-CPQpSD6x.js";import{L as r}from"./label-DJSTogUP.js";import{T as D}from"./textarea-B2322kcJ.js";import{S as m,a as u,b as x,c as h,d as l,C as ye}from"./select-DJ9bU1ut.js";import{c as g,a as _,C as v,b as f}from"./card-C4vkm0ei.js";import{C as Y}from"./checkbox-DSeAieks.js";import{R as Ne,a as R,I as U}from"./radio-group-DYwG0QNP.js";import{f as j,b as Z,P as ee,a as se,C as te}from"./popover-CBm2vE5h.js";import{C as I}from"./camera-znaA5KzM.js";import{T as O}from"./trash-2-KcbQTX7t.js";import{C as ae}from"./calendar-CjLLIQvK.js";/* empty css            */import"./index-D-Yi-hZu.js";import"./index-C2oqPPid.js";import"./index-Cm2o4msX.js";import"./index-DnvY54ZE.js";import"./check-DEEznhPM.js";import"./en-US-BDqzE9Ni.js";import"./chevron-left-DmOQ6lxm.js";function He({order:a,customers:ie,garmentTypes:re,tailors:ne,fabrics:le,statuses:ce,categories:T=[]}){const[N,G]=d.useState([]),[p,de]=d.useState(a.measurement_id?"existing":"skip"),[V,C]=d.useState(!1),[w,oe]=d.useState(a.measurement?.measurements||{}),[A,me]=d.useState(a.measurement?.measurement_type||""),[S,B]=d.useState(a.design_image||null),[M,L]=d.useState(a.customer_fabric_photo||null),[P,E]=d.useState(a.boutique_fabric_photo||null),z=d.useRef(null),$=d.useRef(null),H=d.useRef(null),{data:t,setData:i,put:ue,processing:J,errors:c}=ge({customer_id:a.customer_id?.toString()||"",garment_type_id:a.garment_type_id?.toString()||"",tailor_id:a.tailor_id?.toString()||"",measurement_id:a.measurement_id?.toString()||"",measurement_option:a.measurement_id?"existing":"skip",new_measurement_type:"",new_measurements:{},measurement_notes:"",fabric_id:a.fabric_id?.toString()||"",customer_fabric:a.customer_fabric||!1,boutique_fabric:a.boutique_fabric||!1,customer_fabric_photo:null,boutique_fabric_photo:null,design_image:null,payment_method:"cash",stitching_status_id:a.stitching_status_id?.toString()||"",order_date:a.order_date?j(new Date(a.order_date),"yyyy-MM-dd"):"",delivery_date:a.delivery_date?j(new Date(a.delivery_date),"yyyy-MM-dd"):"",priority:a.priority||"normal",total_amount:a.total_amount?.toString()||"",advance_paid:a.advance_paid?.toString()||"",discount:a.discount?.toString()||"",special_instructions:a.special_instructions||"",notes:a.notes||""});d.useEffect(()=>{a.customer_id&&K(a.customer_id.toString())},[]);const K=async s=>{if(s)try{const n=await _e.get(`/api/measurements?customer_id=${s}`);G(n.data)}catch(n){console.error("Failed to fetch measurements:",n)}else G([])},xe=async s=>{i("customer_id",s),K(s)},he=s=>{de(s),i("measurement_option",s),C(s==="new")},b=T?.find(s=>s.slug===A),je=p==="new"&&b,pe=s=>{s.preventDefault();const n={...t,new_measurements:p==="new"?w:{}};ue(`/orders/${a.id}`,{data:n,onSuccess:()=>{W.success("Order updated successfully")},onError:()=>{W.error("Failed to update order")}})};return e.jsxs(fe,{children:[e.jsx(ve,{title:`Edit Order ${a.order_number}`}),e.jsxs("div",{className:"space-y-6 p-4 max-w-6xl mx-auto",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("h1",{className:"text-3xl font-bold",children:["Edit Order ",a.order_number]})}),e.jsxs("form",{onSubmit:pe,className:"space-y-6",children:[e.jsxs(g,{children:[e.jsx(_,{children:e.jsx(v,{children:"Order Details"})}),e.jsx(f,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(r,{children:"Customer *"}),e.jsxs(m,{value:t.customer_id,onValueChange:xe,children:[e.jsx(u,{children:e.jsx(x,{placeholder:"Select customer"})}),e.jsx(h,{children:ie.map(s=>e.jsx(l,{value:s.id.toString(),children:s.name},s.id))})]}),c.customer_id&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:c.customer_id})]}),e.jsxs("div",{children:[e.jsx(r,{children:"Garment Type *"}),e.jsxs(m,{value:t.garment_type_id,onValueChange:s=>i("garment_type_id",s),children:[e.jsx(u,{children:e.jsx(x,{placeholder:"Select garment type"})}),e.jsx(h,{children:re.map(s=>e.jsx(l,{value:s.id.toString(),children:s.name},s.id))})]}),c.garment_type_id&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:c.garment_type_id})]}),e.jsxs("div",{children:[e.jsx(r,{children:"Tailor *"}),e.jsxs(m,{value:t.tailor_id,onValueChange:s=>i("tailor_id",s),children:[e.jsx(u,{children:e.jsx(x,{placeholder:"Select tailor"})}),e.jsx(h,{children:ne.map(s=>e.jsx(l,{value:s.id.toString(),children:s.name},s.id))})]}),c.tailor_id&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:c.tailor_id})]}),e.jsxs("div",{children:[e.jsx(r,{children:"Status *"}),e.jsxs(m,{value:t.stitching_status_id,onValueChange:s=>i("stitching_status_id",s),children:[e.jsx(u,{children:e.jsx(x,{})}),e.jsx(h,{children:ce.map(s=>e.jsx(l,{value:s.id.toString(),children:s.name},s.id))})]})]})]})})]}),t.customer_id&&e.jsxs(g,{children:[e.jsx(_,{children:e.jsx(v,{children:"Measurements"})}),e.jsxs(f,{className:"space-y-4",children:[e.jsxs(Ne,{value:p,onValueChange:he,children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(R,{value:"skip",id:"skip"}),e.jsx(r,{htmlFor:"skip",className:"cursor-pointer",children:"Skip measurements"})]}),N.length>0&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(R,{value:"existing",id:"existing"}),e.jsx(r,{htmlFor:"existing",className:"cursor-pointer",children:"Use existing measurement"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(R,{value:"new",id:"new"}),e.jsx(r,{htmlFor:"new",className:"cursor-pointer",children:"Create new measurement"})]})]}),p==="existing"&&N.length>0&&e.jsxs("div",{children:[e.jsx(r,{children:"Select Measurement"}),e.jsxs(m,{value:t.measurement_id,onValueChange:s=>i("measurement_id",s),children:[e.jsx(u,{children:e.jsx(x,{placeholder:"Select measurement"})}),e.jsx(h,{children:N.map(s=>e.jsxs(l,{value:s.id.toString(),children:[s.measurement_type," - ",new Date(s.created_at).toLocaleDateString()]},s.id))})]})]}),p==="new"&&e.jsxs("div",{className:"space-y-4 border-t pt-4",children:[e.jsxs("div",{children:[e.jsx(r,{children:"Measurement Type *"}),e.jsxs(m,{value:A,onValueChange:s=>{me(s),i("new_measurement_type",s)},children:[e.jsx(u,{children:e.jsx(x,{placeholder:"Select measurement type"})}),e.jsx(h,{children:T?.map(s=>e.jsx(l,{value:s.slug,children:s.name},s.id))||[]})]})]}),b&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(r,{className:"text-base font-semibold",children:[b.name," Measurements"]}),e.jsx(o,{type:"button",variant:"ghost",size:"sm",onClick:()=>C(!V),children:V?e.jsx(ye,{className:"h-4 w-4"}):e.jsx(be,{className:"h-4 w-4"})})]}),je&&e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4 p-4 rounded-lg border border-muted",children:b?.fields.map(s=>e.jsxs("div",{children:[e.jsxs(r,{htmlFor:s.slug,className:"text-sm",children:[s.name," (",s.unit,")",s.is_required&&e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),e.jsx(y,{id:s.slug,type:"number",step:"0.1",placeholder:"0.0",value:w[s.slug]||"",onChange:n=>{const Q={...w,[s.slug]:n.target.value};oe(Q),i("new_measurements",Q)},required:s.is_required})]},s.id))}),e.jsxs("div",{children:[e.jsx(r,{className:"mb-2",children:"Measurement Notes"}),e.jsx(D,{value:t.measurement_notes,onChange:s=>i("measurement_notes",s.target.value),rows:2,placeholder:"Any special notes about measurements..."})]})]})]})]})]}),e.jsxs(g,{children:[e.jsx(_,{children:e.jsx(v,{children:"Fabric & Design"})}),e.jsxs(f,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Y,{id:"customer_fabric",checked:t.customer_fabric,onCheckedChange:s=>i("customer_fabric",s)}),e.jsx("label",{htmlFor:"customer_fabric",className:"text-sm cursor-pointer",children:"Customer provided fabric"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Y,{id:"boutique_fabric",checked:t.boutique_fabric,onCheckedChange:s=>i("boutique_fabric",s)}),e.jsx("label",{htmlFor:"boutique_fabric",className:"text-sm cursor-pointer",children:"Boutique provided fabric"})]})]}),t.boutique_fabric&&e.jsxs("div",{children:[e.jsx(r,{children:"Fabric"}),e.jsxs(m,{value:t.fabric_id,onValueChange:s=>i("fabric_id",s),children:[e.jsx(u,{children:e.jsx(x,{placeholder:"Select fabric"})}),e.jsx(h,{children:le.map(s=>e.jsxs(l,{value:s.id.toString(),children:[s.name," - $",s.price_per_meter,"/meter"]},s.id))})]})]}),t.boutique_fabric&&e.jsxs("div",{children:[e.jsx(r,{children:"Boutique Fabric Photo"}),e.jsxs("div",{className:"flex items-center gap-4 mt-2",children:[e.jsxs(k,{className:"h-24 w-24 rounded-md",children:[e.jsx(F,{src:P||void 0,alt:"Boutique Fabric",className:"object-cover"}),e.jsx(q,{className:"rounded-md bg-muted",children:e.jsx(U,{className:"h-8 w-8 text-muted-foreground"})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(o,{type:"button",variant:"outline",size:"sm",onClick:()=>H.current?.click(),children:[e.jsx(I,{className:"h-4 w-4 mr-2"}),P?"Change":"Upload"]}),P&&e.jsxs(o,{type:"button",variant:"outline",size:"sm",onClick:()=>{E(null),i("boutique_fabric_photo",null)},children:[e.jsx(O,{className:"h-4 w-4 mr-2"}),"Remove"]})]})]}),e.jsx("input",{ref:H,type:"file",accept:"image/*",onChange:s=>{const n=s.target.files?.[0];n&&(i("boutique_fabric_photo",n),E(URL.createObjectURL(n)))},className:"hidden"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"Upload boutique fabric photo (JPG, PNG or GIF. Max 2MB)"})]}),t.customer_fabric&&e.jsxs("div",{children:[e.jsx(r,{children:"Customer Fabric Photo"}),e.jsxs("div",{className:"flex items-center gap-4 mt-2",children:[e.jsxs(k,{className:"h-24 w-24 rounded-md",children:[e.jsx(F,{src:M||void 0,alt:"Fabric",className:"object-cover"}),e.jsx(q,{className:"rounded-md bg-muted",children:e.jsx(U,{className:"h-8 w-8 text-muted-foreground"})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(o,{type:"button",variant:"outline",size:"sm",onClick:()=>$.current?.click(),children:[e.jsx(I,{className:"h-4 w-4 mr-2"}),M?"Change":"Upload"]}),M&&e.jsxs(o,{type:"button",variant:"outline",size:"sm",onClick:()=>{L(null),i("customer_fabric_photo",null)},children:[e.jsx(O,{className:"h-4 w-4 mr-2"}),"Remove"]})]})]}),e.jsx("input",{ref:$,type:"file",accept:"image/*",onChange:s=>{const n=s.target.files?.[0];n&&(i("customer_fabric_photo",n),L(URL.createObjectURL(n)))},className:"hidden"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"Upload customer fabric photo (JPG, PNG or GIF. Max 2MB)"})]}),e.jsxs("div",{children:[e.jsx(r,{children:"Design Image"}),e.jsxs("div",{className:"flex items-center gap-4 mt-2",children:[e.jsxs(k,{className:"h-24 w-24 rounded-md",children:[e.jsx(F,{src:S||void 0,alt:"Design",className:"object-cover"}),e.jsx(q,{className:"rounded-md bg-muted",children:e.jsx(U,{className:"h-8 w-8 text-muted-foreground"})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(o,{type:"button",variant:"outline",size:"sm",onClick:()=>z.current?.click(),children:[e.jsx(I,{className:"h-4 w-4 mr-2"}),S?"Change":"Upload"]}),S&&e.jsxs(o,{type:"button",variant:"outline",size:"sm",onClick:()=>{B(null),i("design_image",null)},children:[e.jsx(O,{className:"h-4 w-4 mr-2"}),"Remove"]})]})]}),e.jsx("input",{ref:z,type:"file",accept:"image/*",onChange:s=>{const n=s.target.files?.[0];n&&(i("design_image",n),B(URL.createObjectURL(n)))},className:"hidden"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"Upload design reference image (JPG, PNG or GIF. Max 2MB)"})]})]})]}),e.jsxs(g,{children:[e.jsx(_,{children:e.jsx(v,{children:"Pricing & Payment"})}),e.jsxs(f,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx(r,{children:"Total Amount *"}),e.jsx(y,{type:"number",step:"0.01",value:t.total_amount,onChange:s=>i("total_amount",s.target.value),placeholder:"0.00"}),c.total_amount&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:c.total_amount})]}),e.jsxs("div",{children:[e.jsx(r,{children:"Discount"}),e.jsx(y,{type:"number",step:"0.01",value:t.discount,onChange:s=>i("discount",s.target.value),placeholder:"0.00"})]}),e.jsxs("div",{children:[e.jsx(r,{children:"Advance Paid"}),e.jsx(y,{type:"number",step:"0.01",value:t.advance_paid,onChange:s=>i("advance_paid",s.target.value),placeholder:"0.00"})]})]}),e.jsxs("div",{children:[e.jsx(r,{children:"Payment Method"}),e.jsxs(m,{value:t.payment_method,onValueChange:s=>i("payment_method",s),children:[e.jsx(u,{children:e.jsx(x,{})}),e.jsxs(h,{children:[e.jsx(l,{value:"cash",children:"Cash"}),e.jsx(l,{value:"card",children:"Card"}),e.jsx(l,{value:"upi",children:"UPI"}),e.jsx(l,{value:"bank_transfer",children:"Bank Transfer"}),e.jsx(l,{value:"other",children:"Other"})]})]})]})]})]}),e.jsxs(g,{children:[e.jsx(_,{children:e.jsx(v,{children:"Dates & Additional Information"})}),e.jsxs(f,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx(r,{children:"Order Date *"}),e.jsxs(Z,{children:[e.jsx(ee,{asChild:!0,children:e.jsxs(o,{variant:"outline",className:X("w-full justify-start text-left font-normal",!t.order_date&&"text-muted-foreground"),children:[e.jsx(ae,{className:"mr-2 h-4 w-4"}),t.order_date?j(new Date(t.order_date),"PPP"):e.jsx("span",{children:"Pick a date"})]})}),e.jsx(se,{className:"w-auto p-0",children:e.jsx(te,{mode:"single",selected:t.order_date?new Date(t.order_date):void 0,onSelect:s=>i("order_date",s?j(s,"yyyy-MM-dd"):""),initialFocus:!0})})]}),c.order_date&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:c.order_date})]}),e.jsxs("div",{children:[e.jsx(r,{children:"Delivery Date *"}),e.jsxs(Z,{children:[e.jsx(ee,{asChild:!0,children:e.jsxs(o,{variant:"outline",className:X("w-full justify-start text-left font-normal",!t.delivery_date&&"text-muted-foreground"),children:[e.jsx(ae,{className:"mr-2 h-4 w-4"}),t.delivery_date?j(new Date(t.delivery_date),"PPP"):e.jsx("span",{children:"Pick a date"})]})}),e.jsx(se,{className:"w-auto p-0",children:e.jsx(te,{mode:"single",selected:t.delivery_date?new Date(t.delivery_date):void 0,onSelect:s=>i("delivery_date",s?j(s,"yyyy-MM-dd"):""),initialFocus:!0})})]}),c.delivery_date&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:c.delivery_date})]}),e.jsxs("div",{children:[e.jsx(r,{children:"Priority *"}),e.jsxs(m,{value:t.priority,onValueChange:s=>i("priority",s),children:[e.jsx(u,{children:e.jsx(x,{})}),e.jsxs(h,{children:[e.jsx(l,{value:"normal",children:"Normal"}),e.jsx(l,{value:"urgent",children:"Urgent"})]})]})]})]}),e.jsxs("div",{children:[e.jsx(r,{children:"Special Instructions"}),e.jsx(D,{value:t.special_instructions,onChange:s=>i("special_instructions",s.target.value),rows:3,placeholder:"Any special instructions for this order..."})]}),e.jsxs("div",{children:[e.jsx(r,{children:"Notes"}),e.jsx(D,{value:t.notes,onChange:s=>i("notes",s.target.value),rows:2,placeholder:"Internal notes..."})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(o,{type:"button",variant:"outline",onClick:()=>window.history.back(),children:"Cancel"}),e.jsx(o,{type:"submit",disabled:J,children:J?"Updating...":"Update Order"})]})]})]})]})}export{He as default};
